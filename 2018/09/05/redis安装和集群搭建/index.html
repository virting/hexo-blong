<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="用于个人记录在工作和学习中遇到的问题。"><title>redis安装和集群搭建 | 道客鱼</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/highlight.js/9.12.0/styles/atom-one-dark.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-125248295-1","auto"),ga("send","pageview")</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">redis安装和集群搭建</h1><a id="logo" href="/.">道客鱼</a><p class="description">个人博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home">首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">redis安装和集群搭建</h1><div class="post-meta">Sep 5, 2018<span> | </span><span class="category"><a href="/categories/数据库/">数据库</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv">| <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a class="disqus-comment-count" href="/2018/09/05/redis安装和集群搭建/#vcomment"><span class="valine-comment-count" data-xid="/2018/09/05/redis安装和集群搭建/"></span><span> 条评论</span></a><div class="post-content"><h2 id="环境："><a href="#环境：" class="headerlink" title="环境："></a>环境：</h2><h4 id="主机"><a href="#主机" class="headerlink" title="主机"></a>主机</h4><pre><code>192.168.6.85     centos 7.2
192.168.6.110    centos 7.2
192.168.6.111    centos 7.2
192.168.6.112    centos 7.2
</code></pre><h4 id="redis版本："><a href="#redis版本：" class="headerlink" title="redis版本："></a>redis版本：</h4><pre><code>redis-3.2.3
</code></pre><h2 id="安装："><a href="#安装：" class="headerlink" title="安装："></a>安装：</h2><h4 id="1-下载redis："><a href="#1-下载redis：" class="headerlink" title="1.下载redis："></a>1.下载redis：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://download.redis.io/releases/redis-3.2.3.tar.gz</span><br></pre></td></tr></table></figure><h5 id="解压："><a href="#解压：" class="headerlink" title="解压："></a>解压：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf  redis-3.2.3.tar.gz</span><br></pre></td></tr></table></figure><h5 id="编译安装："><a href="#编译安装：" class="headerlink" title="编译安装："></a>编译安装：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span>  redis-3.2.3</span><br><span class="line">yum install -y gcc-c++ jemalloc</span><br><span class="line">make &amp;&amp; make install PREFIX=/data/redis</span><br></pre></td></tr></table></figure><h6 id="错误提示："><a href="#错误提示：" class="headerlink" title="错误提示："></a>错误提示：</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">make[1]: Entering directory `/software/redis-2.8.8/src<span class="string">'</span></span><br><span class="line"><span class="string">CC adlist.o</span></span><br><span class="line"><span class="string">In file included from adlist.c:34:</span></span><br><span class="line"><span class="string">zmalloc.h:50:31: error: jemalloc/jemalloc.h: No such file or directory</span></span><br><span class="line"><span class="string">zmalloc.h:55:2: error: #error "Newer version of jemalloc required"</span></span><br><span class="line"><span class="string">make[1]: *** [adlist.o] Error 1</span></span><br><span class="line"><span class="string">make[1]: Leaving directory `/software/redis-2.8.8/src'</span></span><br><span class="line">make: *** [all] Error 2</span><br></pre></td></tr></table></figure><h6 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h6><p>安装 jemalloc 软件<br>或者： make MALLOC=libc</p><p>安装完成后，/data/redis目录下会有bin目录，需要创建创建相关目录。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/redis;mkdir conf logs data</span><br></pre></td></tr></table></figure><p></p><p>拷贝配置文件到conf目录<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp redis.conf /data/redis/conf/</span><br></pre></td></tr></table></figure><p></p><p>在每台上启动redis<br>安装ruby<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install ruby</span><br><span class="line">gem install redis</span><br></pre></td></tr></table></figure><p></p><p>设置集群命令：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-trib.rb create --replicas 1 192.168.6.85:6379 192.168.6.85:8379 192.168.6.110:6379 192.168.6.110:8379 192.168.6.111:6379 192.168.6.111:8379 192.168.6.112:6379 192.168.6.112:8379</span><br></pre></td></tr></table></figure><p></p><p>输入yes</p></div><iframe src="/donate/?AliPayQR=/img/alipay.png&amp;WeChatQR=/img/Wechatpay.png&amp;GitHub=null&amp;BTCQR=null&amp;BTCKEY=null&amp;PayPal=null" style="overflow-x:hidden;overflow-y:hidden;border:0xp none #fff;min-height:240px;width:100%" frameborder="0" scrolling="no"></iframe><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://dkeyu.com/2018/09/05/redis安装和集群搭建/" data-id="cjlq4crsh00031bt1dgvxqakm" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMElEQVR42u3aQW7DMAwF0d7/0i5QdOdamS+qRUOOVgHiKHpeEKTIjw+8rq91/3x/5v7tdVtPO6/3P7BkyJDxtoxrudZHSX/79FIq+8uQIWMOgwTZCox8mwZ3GTJkyCAhkrBRuJQhQ4aMowxSau4FaBkyZMhYM0hKx6/J0mDN8QdqcRkyZLwho9IY+O3Pf9TfkCFDxj9mXOFKkzzS4Kyc53s3GTJktGaQY6WBmFz6B6Upfx0yZMhozSAhjwx4kWNVhjACjAwZMtox0iSvwk6DctA2kCFDRmtGJeEjzYM0jO6RZMiQMYFBkra9QFxpRfBGqQwZMuYweAMgTSvJk+kAhwwZMuYwSIqWNikrKePe5Z0MGTK6MvgFWT288iBLXt/jzIgMGTLaMUj6xYcheMnKA3qQSsqQIaMpYy/J22sVpEUsueCTIUPGBEb6gzRx5CMXpI0azIzIkCGjHYMPN1TalpVgmr4CGTJkdGKcGqpIC9rKYMfjRZsMGTKaMk5tRNLB9HXEv5IhQ0ZTBi8v9w7Er9L22qUyZMiYyahckNXblqTZ8GJmRIYMGe0Ye4dIG59nE0HUGJAhQ0YjxhWuyqVbWhLzsCtDhozejHrAXW+9Pgo5LtlfhgwZExj1y696mOY8GTJkTGZU/oaUtacuzl4MW8iQIWM8gzc192A8TP/wpAwZMmQcCqxpmRqEXRkyZAxg8CK20k5Yp4aklJUhQ8ZMRtoY4GMTaeistDNlyJDRlPEJ8oSjidCepq4AAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/redis集群/">redis集群</a></div><div class="post-nav"><a class="pre" href="/2018/09/06/nginx/">NGINX 配置 SSL 双向认证</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify=!1,verify=!1,GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter(function(i){return-1<GUEST_INFO.indexOf(i)});guest_info=0==guest_info.length?GUEST_INFO:guest_info,window.valine=new Valine({el:"#vcomment",notify:notify,verify:verify,appId:"xdPkdv2gLbMAUpUW4KuHzOXD-gzGzoHsz",appKey:"NBgfxTI2CgIO4MGpHcyGtR0N",placeholder:"Just so so",avatar:"mm",guest_info:guest_info,pageSize:"10"})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://dkeyu.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o">分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/aws-python/">aws,python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o">标签</i></div><div class="tagcloud"><a href="/tags/nginx-ssl/" style="font-size:15px">nginx, ssl</a> <a href="/tags/redis集群/" style="font-size:15px">redis集群</a> <a href="/tags/aws-route53-python-域名解析/" style="font-size:25px">aws, route53,python, 域名解析</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o">最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/09/10/route53_python/">python脚本删除route53解析记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/10/route53/">aws route53 删除没用的域名解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/06/nginx/">NGINX 配置 SSL 双向认证</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/05/redis安装和集群搭建/">redis安装和集群搭建</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link">友情链接</i></div><ul></ul><a href="https://hexo.io" title="hexo官网" target="_blank">hexo官网</a><ul></ul><a href="http://blog.rookiehacker.org" title="RookieHacker" target="_blank">RookieHacker</a><ul></ul><a href="https://github.com/tufu9441/maupassant-hexo" title="本站模板" target="_blank">本站模板</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">道客鱼.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><i class="fa fa-eye" aria-hidden="true"></i>本站总访问量<span id="busuanzi_value_site_pv"></span>次</div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>